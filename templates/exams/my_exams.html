{% extends '_base.html' %}
{% load static %}

{% block title %}
  Your Exams
{% endblock %}

{% block content %}
  <div class="container">
    <h1>Available Exams</h1>
    <div class="row">
      <div class="col">
        <p>
          <span class="lead">Your exam tokens: <strong>{{ user_exam_tokens }}</strong></span><br><a href="{% url 'get-access-buy' %}">Buy more tokens</a>
        </p>
        <span class="small">Each exam attempt requires one token. You will be asked to confirm your choice before you begin. <br>Note: If you got disconnected and are simply resuming an attempt you will not be charged.</span>
      </div>
    </div>
    <div class="row">
      {% if user_exam_tokens > 0 %}
        {% for exam in exams %}
          <div class="col-md-4 p-4">
            <div class="card">
              <img class="card-img-top p-3" src="{% static 'images/logo-square.png' %}" style="width: 150px; height: auto;" alt="Card image cap" />
              <div class="card-body">
                <h5 class="card-title">{{ exam.name }}</h5>
                <p>2 hours to complete</p>
                <p>{{ exam.questions.all.count }} questions</p>
                <button class="btn btn-primary start-quiz" data-exam-id="{{ exam.uuid }}">Start exam</button>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
      {% for exam in exams %}
          <div class="col-md-4 p-4">
            <div class="card">
              <img class="card-img-top p-3" src="{% static 'images/logo-square.png' %}" style="width: 150px; height: auto;" alt="Card image cap" />
              <div class="card-body">
                <h5 class="card-title">{{ exam.name }}</h5>
                <p>2 hours to complete</p>
                <p>{{ exam.questions.all.count }} questions</p>
                <button class="btn btn-primary" disabled>Out of tokens</button>
              </div>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block javascript %}
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    document.querySelectorAll('.start-quiz').forEach((button) => {
      button.addEventListener('click', function () {
        var examUUID = this.getAttribute('data-exam-id')
        Swal.fire({
          title: 'Ready to begin?',
          text: 'You are about to begin the exam. You have one attempt and two hours to complete. This will spend 1 token. Are you ready to begin?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#175781',
          cancelButtonColor: '#F34C4C',
          confirmButtonText: 'Spend token and start exam'
        }).then((result) => {
          if (result.isConfirmed) {
            // Redirect to take exam view with quiz uuid
            window.location.href = '/exams/exam/' + examUUID
          }
        })
      })
    });
  </script>
{% endblock %}
